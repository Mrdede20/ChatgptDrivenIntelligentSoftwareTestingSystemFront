webpackJsonp([4],{"8wr8":function(t,e){},PBWl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Xxa5"),i=a.n(s),r=a("//Fk"),n=a.n(r),l=a("BO1k"),c=a.n(l),o=a("exGp"),u=a.n(o),d=a("Dd8w"),p=a.n(d),v={data:function(){return{DetaildialogVisible:!1,isLoading:!1,rawData:[],dialogVisible:!1,dialogData:[],currentOrder:{},searchType:"",searchContent:"",searchDialogVisible:!1,searchResults:[],statisticsType:"",statisticsDate:"",statisticsTotalQuantities:{},statisticsTotalSales:{},partPrice:{},statisticsDialogVisible:!1,statisticsChart:null,statisticsResults:[],productIdInput:"",customerIdInput:"",salespersonIdInput:"",selectedPart:{},partImage:""}},computed:{searchPlaceholder:function(){return"orderDate"===this.searchType?"请输入日期（例如：2023-06-26）":"price"===this.searchType?"请输入价格范围（例如：100-200）":""}},created:function(){this.statisticsResults=[{id:"1",count:10},{id:"2",count:15},{id:"3",count:7},{id:"4",count:20}]},mounted:function(){this.getSalesInfo()},methods:{initChart:function(){this.statisticsChart=this.$echarts.init(document.getElementById("statisticsChart")),this.getStatisticsData()},viewPartDetail:function(t){var e=this;this.selectedPart=t,this.$axios("/api/parts/selectOne/"+this.selectedPart.productId).then(function(t){e.selectedPart=t.data,e.partImage=a("czpq")("./"+e.selectedPart.image),e.DetaildialogVisible=!0}).then(function(t){}).catch(function(t){})},getSalesInfo:function(){var t=this;this.$axios("/api/salesOrders/queryAll").then(function(e){t.rawData=e.data.map(function(t){var e=new Date(t.orderDate),a=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0");return p()({},t,{orderDate:a})}),t.InitpartPrice()}).catch(function(t){console.log(t)})},openChart:function(){this.statisticsDate?this.statisticsDialogVisible=!0:this.$message({message:"请输入开始日期和结束日期",type:"warning"})},createDateArray:function(t,e){for(var a=[],s=new Date(t);s<=e;)a.push(s.toISOString().split("T")[0]),s.setDate(s.getDate()+1);return a},getStatisticsData:function(){var t=this,e=this.statisticsDate[0];e.setDate(e.getDate()+1);var a=e.toISOString().split("T")[0],s=this.statisticsDate[1];s.setDate(s.getDate()+1);var i=s.toISOString().split("T")[0],r=this.rawData.filter(function(e){var s=!0;return t.productIdInput&&(s=s&&e.productId.split("^").includes(t.productIdInput)),t.customerIdInput&&(s=s&&e.customerId==t.customerIdInput),t.salespersonIdInput&&(s=s&&e.salespersonId==t.salespersonIdInput),t.statisticsDate&&(console.log("startDateStr"),console.log(a),console.log("endDateStr"),console.log(i),console.log("item.orderDate"),console.log(e.orderDate),s=s&&e.orderDate>=a&&e.orderDate<=i),s});if(this.statisticsDate="",0==r.length)return this.$message.warning("没有找到符合条件的数据"),void(this.statisticsDialogVisible=!1);r.sort(function(t,e){return new Date(t.orderDate)-new Date(e.orderDate)});var n=[],l=this.createDateArray(e,s),c={},o={};r.forEach(function(e){var a=e.productId.split("^"),s=e.quantity.split("^");a.forEach(function(a,i){if(!t.productIdInput||a===t.productIdInput){var r=n.findIndex(function(t){return t.name==a});-1==r&&(n.push({name:a,type:"line",data:new Array(l.length).fill(0),connectNulls:!1}),r=n.length-1),c[a]=(c[a]||0)+Number(s[i]),o[a]=(o[a]||0)+s[i]*t.partPrice[a];var u=l.indexOf(e.orderDate);n[r].data[u]=(n[r].data[u]||0)+Number(s[i])}}),n.forEach(function(t){a.includes(t.name)||(t.data[l.indexOf(e.orderDate)]=0)})}),this.statisticsChart.clear(),this.statisticsChart.setOption({title:[{text:"销售统计",subtext:"按商品和日期",left:"center"},{text:"配件ID",left:"5%",top:"1%",textAlign:"center"}],tooltip:{trigger:"axis"},legend:{data:n.map(function(t){return t.name}),left:"3%",top:"8%",orient:"vertical"},xAxis:{type:"category",data:l,name:"时间"},yAxis:{type:"value",name:"销量"},series:n.map(function(t){return p()({},t,{lineStyle:{width:2}})})}),this.statisticsTotalSales=o,this.statisticsTotalQuantities=c},InitpartPrice:function(){var t=this;return u()(i.a.mark(function e(){var a,s,r,l,o,u,d,p;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,a=!0,s=!1,r=void 0,e.prev=4,l=c()(t.rawData);case 6:if(a=(o=l.next()).done){e.next=15;break}return u=o.value,d=u.productId.split("^"),p=d.map(function(e){return t.$axios.get("/api/parts/selectOne/"+e).then(function(a){t.partPrice[e]=a.data.price})}),e.next=12,n.a.all(p);case 12:a=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),s=!0,r=e.t0;case 21:e.prev=21,e.prev=22,!a&&l.return&&l.return();case 24:if(e.prev=24,!s){e.next=27;break}throw r;case 27:return e.finish(24);case 28:return e.finish(21);case 29:e.next=33;break;case 31:e.prev=31,e.t1=e.catch(0);case 33:case"end":return e.stop()}},e,t,[[0,31],[4,17,21,29],[22,,24,28]])}))()},showDetails:function(t){this.currentOrder=t;var e=t.productId.split("^"),a=t.quantity.split("^");this.dialogData=e.map(function(t,e){return{productId:t,quantity:a[e]}}),this.dialogVisible=!0}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"top_class",staticStyle:{display:"flex","justify-content":"space-between","margin-bottom":"10px"}},[a("div",{staticClass:"statisticsClass",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[a("el-input",{staticClass:"statistics-input",attrs:{placeholder:"请输入商品ID"},model:{value:t.productIdInput,callback:function(e){t.productIdInput=e},expression:"productIdInput"}}),t._v(" "),a("el-input",{staticClass:"statistics-input",attrs:{placeholder:"请输入客户ID"},model:{value:t.customerIdInput,callback:function(e){t.customerIdInput=e},expression:"customerIdInput"}}),t._v(" "),a("el-input",{staticClass:"statistics-input",attrs:{placeholder:"请输入销售员ID"},model:{value:t.salespersonIdInput,callback:function(e){t.salespersonIdInput=e},expression:"salespersonIdInput"}}),t._v(" "),a("el-date-picker",{staticClass:"statistics-input",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.statisticsDate,callback:function(e){t.statisticsDate=e},expression:"statisticsDate"}}),t._v(" "),a("el-button",{staticClass:"statistics-button",on:{click:t.openChart}},[t._v("统计")])],1)]),t._v(" "),a("hr"),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.rawData}},[a("el-table-column",{attrs:{prop:"orderId",label:"销售订单ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"customerId",label:"客户ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"salespersonId",label:"销售员ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orderDate",label:"订单日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"总价"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{on:{click:function(a){t.showDetails(e.row)}}},[t._v("详细")])]}}])})],1),t._v(" "),a("div",{staticClass:"wrapper"},[a("el-dialog",{attrs:{visible:t.statisticsDialogVisible,title:"统计结果",width:"70%"},on:{"update:visible":function(e){t.statisticsDialogVisible=e},opened:t.initChart}},[a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"statisticsChart"}}),t._v(" "),t.isLoading?a("el-loading",{attrs:{fullscreen:!1,lock:!0,text:"正在加载统计数据...",spinner:"el-icon-loading",background:t.rgba(0,0,0,.8)}}):t._e(),t._v(" "),a("div",{staticClass:"statistics-total-quantities"},[a("h3",[t._v("每种产品这段时间的销量总数:")]),t._v(" "),a("ul",t._l(t.statisticsTotalQuantities,function(e,s){return a("li",{key:s},[t._v("\n            商品ID: "+t._s(s)+" - 销量总数: "+t._s(e)+" 件\n          ")])}),0)]),t._v(" "),a("div",{staticClass:"statistics-total-quantities"},[a("h3",[t._v("每种产品这段时间的销量总额:")]),t._v(" "),a("ul",t._l(t.statisticsTotalSales,function(e,s){return a("li",{key:s},[t._v("\n            商品ID: "+t._s(s)+" - 销量总额: "+t._s(e)+" 元\n          ")])}),0)])],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,title:"详细信息"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("h3",[t._v("订单ID: "+t._s(t.currentOrder.orderId))]),t._v(" "),a("h3",[t._v("客户ID: "+t._s(t.currentOrder.customerId))]),t._v(" "),a("h3",[t._v("销售员ID: "+t._s(t.currentOrder.salespersonId))]),t._v(" "),a("h3",[t._v("订单日期: "+t._s(t.currentOrder.orderDate))]),t._v(" "),a("h3",[t._v("总价: "+t._s(t.currentOrder.totalPrice))]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.dialogData}},[a("el-table-column",{attrs:{prop:"productId",label:"商品ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"商品数量"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{on:{click:function(a){t.viewPartDetail(e.row)}}},[t._v("详细")])]}}])})],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.searchDialogVisible,title:"搜索结果"},on:{"update:visible":function(e){t.searchDialogVisible=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.searchResults}},[a("el-table-column",{attrs:{prop:"orderId",label:"销售订单ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"customerId",label:"客户ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"salespersonId",label:"销售员ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orderDate",label:"订单日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"总价"}})],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.DetaildialogVisible,width:"50%",center:""},on:{"update:visible":function(e){t.DetaildialogVisible=e}}},[a("div",{staticClass:"part-detail"},[a("h2",[t._v(t._s(t.selectedPart.partName))]),t._v(" "),a("el-image",{staticClass:"part-image",attrs:{src:t.partImage}}),t._v(" "),a("div",{staticClass:"part-info"},[a("p",[a("strong",[t._v("配件ID：")]),t._v(t._s(t.selectedPart.partId))]),t._v(" "),a("p",[a("strong",[t._v("模型：")]),t._v(t._s(t.selectedPart.model))]),t._v(" "),a("p",[a("strong",[t._v("颜色：")]),t._v(t._s(t.selectedPart.color))]),t._v(" "),a("p",[a("strong",[t._v("适用模型：")]),t._v(t._s(t.selectedPart.applicableModels))]),t._v(" "),a("p",[a("strong",[t._v("价格：")]),t._v(t._s(t.selectedPart.price))]),t._v(" "),a("p",[a("strong",[t._v("库存数量：")]),t._v(t._s(t.selectedPart.inventoryQuantity))])])],1)])],1)},staticRenderFns:[]};var _=a("VU/8")(v,h,!1,function(t){a("8wr8")},"data-v-14c51c1e",null);e.default=_.exports}});