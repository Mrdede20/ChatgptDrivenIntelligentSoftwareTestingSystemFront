webpackJsonp([38],{"8Jn6":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),l=s.n(a),i=s("exGp"),n=s.n(i),o={data:function(){return{phoneRecordDialogVisible:!1,phoneRecordContent:"",phoneRecordPurchaseIntention:"",showDeleteDialog:!1,deleteIndex:null,dispatchList:[],searchId:"",isAddFormVisible:!1,newDispatch:{customerId:"",installTime:null,installer:"",status:"",returnTime:null,address:""},formRules:{}}},created:function(){this.getPartsInfo()},methods:{getPartsInfo:function(){var e=this;this.$axios("/api/serviceInstallation/selectAll").then(function(t){var s=t.data;e.dispatchList=s.map(function(e){return{customerId:e.customerid,installTime:e.installtime,installer:e.installer,status:e.status,returnTime:e.returntime,address:e.address}})}).catch(function(e){console.log(e)})},deleteComplaint:function(e){this.deleteIndex=e,this.showDeleteDialog=!0},confirmDelete:function(){var e=this,t=this.dispatchList[this.deleteIndex].customerId;this.$axios.delete("/api/serviceInstallation/del/"+t).then(function(t){e.$message.success("删除成功"),e.dispatchList.splice(e.deleteIndex,1),e.showDeleteDialog=!1}).catch(function(t){e.$message.error("删除失败")})},open:function(){var e=this;this.$confirm("将对客户发送回访, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$message({type:"success",message:"操作成功"})}).catch(function(){e.$message({type:"info",message:"已取消操作"})})},searchDispatch:function(){console.log("搜索派工列表",this.searchId),this.fetchDispatchList(this.searchId)},fetchDispatchList:function(e){var t=this;return n()(l.a.mark(function s(){var a;return l.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,axios.get("/api/dispatches",{params:{customerId:e}});case 3:a=s.sent,t.dispatchList=a.data,s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),console.error(s.t0);case 10:case"end":return s.stop()}},s,t,[[0,7]])}))()},returnVisit:function(e){console.log("回访派工",e)},deleteDispatch:function(e){var t=this.dispatchList.indexOf(e);console.log("删除派工",e),this.dispatchList.splice(t,1)},showAddForm:function(){this.isAddFormVisible=!0},cancelAddForm:function(){this.isAddFormVisible=!1,this.newDispatch={customerId:"",installTime:null,installer:"",status:"",returnTime:null,address:""},this.$refs.addForm.resetFields()},submitAddForm:function(){var e,t=this;this.$refs.addForm.validate((e=n()(l.a.mark(function e(s){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=8;break}console.log("新增派工记录",t.newDispatch),t.isAddFormVisible=!1,t.newDispatch={customerId:"",installTime:null,installer:"",status:"",returnTime:null,address:""},t.$refs.addForm.resetFields(),t.$message({type:"success",message:"添加成功！"}),e.next=10;break;case 8:return console.log("表单验证失败"),e.abrupt("return",!1);case 10:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v("派工列表")])]),e._v(" "),s("el-scrollbar",{staticStyle:{height:"400px"}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dispatchList}},[s("el-table-column",{attrs:{prop:"customerId",label:"客户ID",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"installTime",label:"安装时间",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"installer",label:"安装人员"}}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"处理状态"}}),e._v(" "),s("el-table-column",{attrs:{prop:"returnTime",label:"回访时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"address",label:"地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"回访"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"success"},on:{click:e.open}},[e._v("回访")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"operation-btns"},[s("el-button",{staticClass:"delete-btn",attrs:{type:"danger"},on:{click:function(s){e.showDeleteDialog=!0,e.deleteIndex=t.$index}}},[e._v("撤销")])],1)]}}])})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"确认删除",visible:e.showDeleteDialog,width:"30%"},on:{"update:visible":function(t){e.showDeleteDialog=t},close:function(t){e.showDeleteDialog=!1}}},[s("span",[e._v("确定删除该派工记录吗？")]),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showDeleteDialog=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelete}},[e._v("确定")])],1)]),e._v(" "),s("el-dialog",{attrs:{title:"新增派工记录",visible:e.isAddFormVisible},on:{"update:visible":function(t){e.isAddFormVisible=t}}},[s("el-form",{ref:"addForm",attrs:{model:e.newDispatch,rules:e.formRules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"客户ID",prop:"customerId"}},[s("el-input",{model:{value:e.newDispatch.customerId,callback:function(t){e.$set(e.newDispatch,"customerId",t)},expression:"newDispatch.customerId"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"安装时间",prop:"installTime"}},[s("el-date-picker",{attrs:{type:"date"},model:{value:e.newDispatch.installTime,callback:function(t){e.$set(e.newDispatch,"installTime",t)},expression:"newDispatch.installTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"安装人员",prop:"installer"}},[s("el-input",{model:{value:e.newDispatch.installer,callback:function(t){e.$set(e.newDispatch,"installer",t)},expression:"newDispatch.installer"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"地址",prop:"installer"}},[s("el-input",{model:{value:e.newDispatch.installer,callback:function(t){e.$set(e.newDispatch,"installer",t)},expression:"newDispatch.installer"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.cancelAddForm}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submitAddForm}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var c=s("VU/8")(o,r,!1,function(e){s("X8hg")},"data-v-4cafd03a",null);t.default=c.exports},X8hg:function(e,t){}});