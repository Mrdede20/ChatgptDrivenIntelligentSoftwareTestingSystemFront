webpackJsonp([31],{Ig38:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n={data:function(){return{manager:{managerId:null,managerName:null,managerSex:null,managerTel:null},managerList:[],marketing:{marketingType:null,marketingName:null,marketingStartTime:null,marketingEndTime:null,marketingTableId:null},selectedMarketingType:null,verificationResult:"",showTable:!1,showTable2:!1,accessoryList:[],clientList:[],selectedRows:[],selectedRows2:[],selectedAccessories:[],selectedClients:[]}},created:function(){this.getManagerList(),this.getAccessoryList(),this.getClientList()},methods:{editList:function(){this.selectedMarketingType?"季度营销活动"===this.selectedMarketingType?this.showTable=!0:"年度营销活动"===this.selectedMarketingType&&(this.showTable2=!0):this.$message.warning("未选择营销活动类型")},handleMarketingTypeChange:function(){"季度营销活动"===this.marketing.marketingType?(this.selectedMarketingType="季度营销活动",this.showTable=!0,this.showTable2=!1):"年度营销活动"===this.marketing.marketingType?(this.selectedMarketingType="年度营销活动",this.showTable=!1,this.showTable2=!0):(this.selectedMarketingType=null,this.showTable=!1,this.showTable2=!1)},handleSelectionChange:function(e){this.selectedRows=e},handleSelectionChange2:function(e){this.selectedRows2=e},add:function(){var e=this;if("验证成功"===this.verificationResult)if(this.marketing.marketingType&&this.marketing.marketingName&&this.marketing.marketingStartTime&&this.marketing.marketingEndTime&&this.marketing.marketingTableId){var a=new Date(this.marketing.marketingStartTime);if(new Date(this.marketing.marketingEndTime)<=a)this.$message.error("活动结束时间至少要大于开始时间1天");else if("季度营销活动"===this.selectedMarketingType){this.selectedAccessories=this.selectedRows.map(function(a){return{tableId:e.marketing.marketingTableId,accessoryId:a.Accessory_id,accessoryName:a.Accessory_name,accessoryType:a.Accessory_type,accessoryQuantity:a.Accessory_quantity,accessoryAmount:a.Accessory_amount,accessoryDiscount:a.Accessory_discount,accessoryCar:a.Accessory_car}});var t={activityName:this.marketing.marketingName,activityType:this.marketing.marketingType,startDate:this.marketing.marketingStartTime,endDate:this.marketing.marketingEndTime,responsibleId:this.manager.managerId,accessoryTableId:this.marketing.marketingTableId,activityState:"进行中"};this.$axios.post("/api/marketingactivity/add",t).then(function(a){e.$message.success("新活动已添加"),e.selectedAccessories.forEach(function(a){e.$axios.post("/api/marketingaccessorytable/add",a).then(function(e){}).catch(function(e){})})}).catch(function(a){e.$message.error("添加新活动失败")})}else if("年度营销活动"===this.selectedMarketingType){this.selectedClients=this.selectedRows2.map(function(a){return{tableId:e.marketing.marketingTableId,clientName:a.clientName,clientType:a.clientType,clientCar:a.clientCar,clientTel:a.clientTel,cumulativeSpend:a.cumulativeSpend}});var n={activityName:this.marketing.marketingName,activityType:this.marketing.marketingType,startDate:this.marketing.marketingStartTime,endDate:this.marketing.marketingEndTime,responsibleId:this.manager.managerId,accessoryTableId:this.marketing.marketingTableId,activityState:"进行中"};this.$axios.post("/api/marketingactivity/add",n).then(function(a){e.$message.success("新活动已添加"),e.selectedClients.forEach(function(a){e.$axios.post("/api/marketingclienttable/add",a).then(function(e){}).catch(function(e){})})}).catch(function(a){e.$message.error("添加新活动失败")})}}else this.$message.error("请完整填写营销活动信息");else this.$message.error("请先进行经理身份验证")},getManagerList:function(){var e=this;this.$axios("/api/marketingmanager/selectAll").then(function(a){var t=a.data;e.managerList=t.map(function(e){return{managerId:e.id,managerName:e.name,managerSex:e.sex,managerTel:e.telephone}})}).catch(function(e){console.log(e)})},getAccessoryList:function(){var e=this;this.$axios("/api/marketingaccessory/selectAll").then(function(a){var t=a.data;e.accessoryList=t.map(function(e){return{Accessory_id:e.id,Accessory_name:e.accessoryName,Accessory_type:e.accessoryType,Accessory_quantity:e.accessoryQuantity,Accessory_amount:e.accessoryAmount,Accessory_car:e.accessoryCar,Accessory_discount:null}})}).catch(function(e){console.log(e)})},getClientList:function(){var e=this;this.$axios("/api/marketingclient/selectAll").then(function(a){var t=a.data;e.clientList=t.map(function(e){return{id:e.id,clientName:e.clientName,clientType:e.clientType,clientCar:e.clientCar,clientTel:e.clientTel,cumulativeSpend:e.cumulativeSpend}})}).catch(function(e){console.log(e)})},verifyManager:function(){var e=this.manager,a=e.managerId,t=e.managerName,n=e.managerSex,s=e.managerTel;if(a&&t&&n&&s){var i=this.managerList.find(function(e){return e.managerId===a&&e.managerName===t&&e.managerSex===n&&e.managerTel===s});this.verificationResult=i?"验证成功":"验证失败"}else this.verificationResult="未输入完全"},getInputClass:function(e){var a=this.verificationResult,t=this.manager;return"验证成功"===a&&t[e]||"验证失败"===a&&t[e]?"is-success":"未输入完全"===a&&!t[e]||"验证失败"===a&&!t[e]?"is-error":"未输入完全"===a&&null===t[e]?"is-focus":""}}},s={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-card",{staticClass:"box-card",attrs:{id:"card1"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("销售经理身份验证")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.verifyManager}},[e._v("\n              "+e._s(e.verificationResult||"验证")+"\n            ")])],1),e._v(" "),t("el-form",{ref:"manager",attrs:{model:e.manager,"label-width":"200px"}},[t("el-form-item",{attrs:{label:"销售经理编号",prop:"managerId"}},[t("el-input",{class:e.getInputClass("managerId"),attrs:{placeholder:"请输入经理编号","prefix-icon":"el-icon-check"},model:{value:e.manager.managerId,callback:function(a){e.$set(e.manager,"managerId",e._n(a))},expression:"manager.managerId"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"销售经理姓名",prop:"managerName"}},[t("el-input",{class:e.getInputClass("managerName"),attrs:{placeholder:"请输入经理姓名","prefix-icon":"el-icon-check"},model:{value:e.manager.managerName,callback:function(a){e.$set(e.manager,"managerName",a)},expression:"manager.managerName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"销售经理性别",prop:"managerSex"}},[t("el-select",{class:e.getInputClass("managerSex"),attrs:{placeholder:"请选择经理性别","prefix-icon":"el-icon-check"},model:{value:e.manager.managerSex,callback:function(a){e.$set(e.manager,"managerSex",a)},expression:"manager.managerSex"}},[t("el-option",{attrs:{label:"男",value:"男"}}),e._v(" "),t("el-option",{attrs:{label:"女",value:"女"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"销售经理电话",prop:"managerTel"}},[t("el-input",{class:e.getInputClass("managerTel"),attrs:{placeholder:"请输入联系电话","prefix-icon":"el-icon-check"},model:{value:e.manager.managerTel,callback:function(a){e.$set(e.manager,"managerTel",a)},expression:"manager.managerTel"}})],1)],1)],1),e._v(" "),t("el-card",{directives:[{name:"show",rawName:"v-show",value:"验证成功"===e.verificationResult,expression:"verificationResult === '验证成功'"}],staticClass:"box-card",attrs:{id:"card2"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("营销活动信息输入")])]),e._v(" "),t("el-form",{ref:"marketing",attrs:{model:e.marketing,"label-width":"200px"}},[t("el-form-item",{attrs:{label:"营销活动类型",prop:"marketingType"}},[t("el-select",{attrs:{placeholder:"请选择活动类型"},on:{change:e.handleMarketingTypeChange},model:{value:e.marketing.marketingType,callback:function(a){e.$set(e.marketing,"marketingType",e._n(a))},expression:"marketing.marketingType"}},[t("el-option",{attrs:{label:"季度营销活动",value:"季度营销活动"}}),e._v(" "),t("el-option",{attrs:{label:"年度营销活动",value:"年度营销活动"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"营销活动名称",prop:"marketingName"}},[t("el-input",{attrs:{placeholder:"请输入营销活动名称"},model:{value:e.marketing.marketingName,callback:function(a){e.$set(e.marketing,"marketingName",a)},expression:"marketing.marketingName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"营销活动开始时间",prop:"marketingStartTime"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择开始时间"},model:{value:e.marketing.marketingStartTime,callback:function(a){e.$set(e.marketing,"marketingStartTime",a)},expression:"marketing.marketingStartTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"营销活动结束时间",prop:"marketingEndTime"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择结束时间"},model:{value:e.marketing.marketingEndTime,callback:function(a){e.$set(e.marketing,"marketingEndTime",a)},expression:"marketing.marketingEndTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"营销活动表格ID",prop:"marketingTableId"}},[t("el-input",{attrs:{placeholder:"请输入营销活动表格ID"},model:{value:e.marketing.marketingTableId,callback:function(a){e.$set(e.marketing,"marketingTableId",a)},expression:"marketing.marketingTableId"}})],1),e._v(" "),t("el-form-item",[t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.add()}}},[e._v("确定")])],1)])],1)],1),e._v(" "),t("el-card",{directives:[{name:"show",rawName:"v-show",value:e.showTable,expression:"showTable"}],staticClass:"box-card",attrs:{id:"card3"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("选择商品列表")])]),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.accessoryList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"},model:{value:e.selectedRows,callback:function(a){e.selectedRows=a},expression:"selectedRows"}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_id",label:"配件编号",sortable:""}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_name",label:"配件名称"}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_type",label:"配件类型"}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_amount",label:"配件金额",sortable:""}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_car",label:"适配车型"}}),e._v(" "),t("el-table-column",{attrs:{prop:"Accessory_discount",label:"配件折扣"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{placeholder:"请选择折扣"},on:{change:function(t){e.handleDiscountChange(a.row)}},model:{value:a.row.Accessory_discount,callback:function(t){e.$set(a.row,"Accessory_discount",t)},expression:"scope.row.Accessory_discount"}},[t("el-option",{attrs:{label:"八折",value:"0.8"}}),e._v(" "),t("el-option",{attrs:{label:"八五折",value:"0.85"}}),e._v(" "),t("el-option",{attrs:{label:"九折",value:"0.9"}}),e._v(" "),t("el-option",{attrs:{label:"九五折",value:"0.95"}})],1)]}}])})],1)],1),e._v(" "),t("el-card",{directives:[{name:"show",rawName:"v-show",value:e.showTable2,expression:"showTable2"}],staticClass:"box-card",attrs:{id:"card4"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("选择顾客列表")])]),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.clientList},on:{"selection-change":e.handleSelectionChange2}},[t("el-table-column",{attrs:{type:"selection",width:"55"},model:{value:e.selectedRows2,callback:function(a){e.selectedRows2=a},expression:"selectedRows2"}}),e._v(" "),t("el-table-column",{attrs:{prop:"id",label:"客户编号",sortable:""}}),e._v(" "),t("el-table-column",{attrs:{prop:"clientName",label:"客户姓名"}}),e._v(" "),t("el-table-column",{attrs:{prop:"clientType",label:"客户常购买配件类型"}}),e._v(" "),t("el-table-column",{attrs:{prop:"clientCar",label:"客户常购买配件车型"}}),e._v(" "),t("el-table-column",{attrs:{prop:"clientTel",label:"客户电话"}}),e._v(" "),t("el-table-column",{attrs:{prop:"cumulativeSpend",label:"客户最近花费",sortable:""}})],1)],1)],1)},staticRenderFns:[]};var i=t("VU/8")(n,s,!1,function(e){t("nAD/")},null,null);a.default=i.exports},"nAD/":function(e,a){}});