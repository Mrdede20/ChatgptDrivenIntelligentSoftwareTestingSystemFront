webpackJsonp([57],{zQmP:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={data:function(){return{orderForm:{activityId:null,activityName:null,salespersonId:null,salespersonName:null,accessoryId:null,accessoryName:null,accessoryType:null,accessoryQuantity:null,accessoryAmount:null,clientId:null,clientName:null},callForm:{callTime:"2023-06-24T16:00:00.000+00:00",salespersonId:1,salespersonName:"小刘",callContent:"",purchaseIntent:"",clientId:"",clientName:""},clientList:[],activityList:[],salemanList:[],accessoryList:[],defaultSort:{prop:"Client_id",order:"ascending"},phoneRecordDialogVisible:!1,phoneRecordContent:"",phoneRecordPurchaseIntention:"",sendMessqgeDialogVisible:!1,sendMessqgeContent:"",orderDialogVisible:!1,orderDialogVisible2:!1,currentRow:null}},created:function(){this.getActivityList(),this.getClientList(),this.getAccessoryList(),this.getSalemanList()},methods:{getSalemanList:function(){var e=this;this.$axios("/api/marketingrank/selectAll").then(function(t){var o=t.data;e.salemanList=o.map(function(e){return{Salesperson_id:e.id,Salesperson_name:e.salespersonName}}),e.calculateSalespersonRank()}).catch(function(e){console.log(e)})},getAccessoryList:function(){var e=this;this.$axios("/api/marketingaccessory/selectAll").then(function(t){var o=t.data;e.accessoryList=o.map(function(e){return{accessoryId:e.id,accessoryName:e.accessoryName,accessoryType:e.accessoryType}})}).catch(function(e){console.log(e)})},getActivityList:function(){var e=this;this.$axios("/api/marketingactivity/selectAll").then(function(t){var o=t.data;e.activityList=o.map(function(e){return{activityId:e.id,activityName:e.activityName}})}).catch(function(e){console.log(e)})},addCall:function(){var e=this;this.$axios({url:"/api/marketingclient/update",method:"put",data:{id:this.callForm.clientId,clientName:null,clientType:null,clientCar:null,clientTel:null,purchaseIntention:this.callForm.purchaseIntent,cumulativeSpend:null}}),this.$axios({url:"/api/marketingcallactivity/add",method:"post",data:{callTime:this.callForm.callTime,salespersonId:this.callForm.salespersonId,salespersonName:this.callForm.salespersonName,callContent:this.callForm.callContent,purchaseIntent:this.callForm.purchaseIntent,clientId:this.callForm.clientId,clientName:this.callForm.clientName}}).then(function(t){console.log(e.callForm),e.$message.success("电话已拨打完成"),e.getClientList()}).catch(function(t){e.$message.error("Failed to add the new call.")})},addOrder:function(){var e=this;this.$axios({url:"/api/marketingorders/add",method:"post",data:{activityId:this.orderForm.activityId,activityName:this.orderForm.activityName,salespersonId:this.orderForm.salespersonId,salespersonName:this.orderForm.salespersonName,accessoryId:this.orderForm.accessoryId,accessoryName:this.orderForm.accessoryName,accessoryType:this.orderForm.accessoryType,accessoryQuantity:this.orderForm.accessoryQuantity,accessoryAmount:this.orderForm.accessoryAmount,clientId:this.orderForm.clientId,clientName:this.orderForm.clientName}}).then(function(t){console.log(e.orderForm),e.$axios.get("/api/marketingrank/selectById/"+e.orderForm.salespersonId).then(function(t){var o=t.data.id,s=Number(t.data.orderCount)+1,r=Number(t.data.salesAmount)+Number(e.orderForm.accessoryAmount)*Number(e.orderForm.accessoryQuantity);e.$axios({url:"/api/marketingrank/update",method:"put",data:{id:o,salespersonName:null,orderCount:s,salesAmount:r,salespersonRank:null}})}),e.$axios.get("/api/marketingclient/selectById/"+e.orderForm.clientId).then(function(t){t.data.id;var o=Number(t.data.cumulativeSpend)+Number(e.orderForm.accessoryAmount)*Number(e.orderForm.accessoryQuantity);e.$axios({url:"/api/marketingclient/update",method:"put",data:{id:e.orderForm.clientId,clientName:null,clientType:null,clientCar:null,clientTel:null,purchaseIntention:null,cumulativeSpend:o}}).then(function(t){e.getClientList()})}),e.getClientList(),e.$message.success("新订单已添加")}).catch(function(t){e.$message.error("Failed to add the new order.")})},getClientList:function(){var e=this;this.$axios("/api/marketingclient/selectAll").then(function(t){var o=t.data;e.clientList=o.map(function(e){return{Client_id:e.id,Client_name:e.clientName,Client_type:e.clientType,Client_car:e.clientCar,Client_tel:e.clientTel,Purchase_Intention:e.purchaseIntention,Cumulative_Spend:e.cumulativeSpend}})}).catch(function(e){console.log(e)})},call:function(e){console.log("拨打电话:",e),this.openPhoneRecordDialog()},sendMessage:function(e){console.log("发送短信:",e)},sell:function(e){console.log("进行销售，客户编号:",e)},showPurchaseIntention:function(e){this.$message({message:"购买意向: "+e.Purchase_Intention,type:"info"})},openPhoneRecordDialog:function(e){this.currentRow=e,this.phoneRecordContent="",this.phoneRecordPurchaseIntention=e.Purchase_Intention,this.callForm.clientId=e.Client_id,this.callForm.clientName=e.Client_name,this.phoneRecordDialogVisible=!0},closePhoneRecordDialog:function(){this.phoneRecordDialogVisible=!1},confirmPhoneRecordDialog:function(){this.currentRow.Purchase_Intention=this.phoneRecordPurchaseIntention,this.callForm.callContent=this.phoneRecordContent,this.callForm.purchaseIntent=this.phoneRecordPurchaseIntention,console.log("通话内容:",this.phoneRecordContent),console.log("修改后的购买意向:",this.phoneRecordPurchaseIntention),this.addCall(),this.phoneRecordDialogVisible=!1},openOrderDialog:function(e){this.orderForm.clientId=e.Client_id,this.orderForm.clientName=e.Client_name,this.orderDialogVisible=!0},closeOrderDialog:function(){this.orderDialogVisible=!1},closeOrderDialog2:function(){this.orderDialogVisible2=!1},confirmOrderDialog:function(){var e=Number(this.orderForm.activityId),t=this.orderForm.activityName,o=Number(this.orderForm.salespersonId),s=this.orderForm.salespersonName;if(e&&t&&o&&s){var r=this.activityList.find(function(o){return o.activityId===e&&o.activityName===t}),n=this.salemanList.find(function(e){return e.Salesperson_id===o&&e.Salesperson_name===s});r?n?(this.orderDialogVisible=!1,this.orderDialogVisible2=!0):this.$message({message:"销售人员不存在",type:"error"}):this.$message({message:"营销活动不存在",type:"error"})}else this.$message({message:"输入不完全",type:"error"})},confirmOrderDialog2:function(){var e=Number(this.orderForm.accessoryId),t=this.orderForm.accessoryName,o=this.orderForm.accessoryType,s=Number(this.orderForm.accessoryQuantity),r=Number(this.orderForm.accessoryAmount);e&&t&&o&&s&&r?this.accessoryList.find(function(s){return s.accessoryId===e&&s.accessoryName===t&&s.accessoryType===o})?(this.addOrder(),this.orderDialogVisible2=!1):this.$message({message:"销售物品不存",type:"error"}):this.$message({message:"输入不完全",type:"error"})},openSendMessqgeDialog:function(e){this.currentRow=e,this.sendMessqgeContent="",this.sendMessqgeDialogVisible=!0},closeSendMessqgeDialog:function(){this.sendMessqgeDialogVisible=!1},confirmSendMessqgeDialog:function(){this.$message({message:"已发送短信: "+this.sendMessqgeContent,type:"success"}),console.log("短信内容:",this.sendMessqgeContent),this.sendMessqgeDialogVisible=!1}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.clientList,border:"",stripe:"","default-sort":e.defaultSort}},[o("el-table-column",{attrs:{prop:"Client_id",label:"客户编号",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"Client_name",label:"客户名称"}}),e._v(" "),o("el-table-column",{attrs:{prop:"Client_type",label:"配件类型"}}),e._v(" "),o("el-table-column",{attrs:{prop:"Client_car",label:"车型类型"}}),e._v(" "),o("el-table-column",{attrs:{prop:"Client_tel",label:"客户电话"}}),e._v(" "),o("el-table-column",{attrs:{prop:"Cumulative_Spend",label:"最近花费"}}),e._v(" "),o("el-table-column",{attrs:{label:"购买意向"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.showPurchaseIntention(t.row)}}},[e._v("查看")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"拨打电话"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary"},on:{click:function(o){e.openPhoneRecordDialog(t.row)}}},[e._v("拨打电话")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"发送短信"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"success"},on:{click:function(o){e.openSendMessqgeDialog(t.row.Client_tel)}}},[e._v("发送短信")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"进行销售"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"warning"},on:{click:function(o){e.openOrderDialog(t.row)}}},[e._v("进行销售")])]}}])})],1),e._v(" "),o("el-dialog",{attrs:{visible:e.phoneRecordDialogVisible,title:"电话内容记录",width:"30%"},on:{"update:visible":function(t){e.phoneRecordDialogVisible=t}}},[o("el-input",{attrs:{type:"textarea",placeholder:"通话内容"},model:{value:e.phoneRecordContent,callback:function(t){e.phoneRecordContent=t},expression:"phoneRecordContent"}}),e._v(" "),o("el-input",{attrs:{type:"textarea",placeholder:"购买意向"},model:{value:e.phoneRecordPurchaseIntention,callback:function(t){e.phoneRecordPurchaseIntention=t},expression:"phoneRecordPurchaseIntention"}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closePhoneRecordDialog}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmPhoneRecordDialog}},[e._v("确认")])],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.sendMessqgeDialogVisible,title:"短信内容编辑",width:"30%"},on:{"update:visible":function(t){e.sendMessqgeDialogVisible=t}}},[o("el-input",{attrs:{type:"textarea",placeholder:"短信内容"},model:{value:e.sendMessqgeContent,callback:function(t){e.sendMessqgeContent=t},expression:"sendMessqgeContent"}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeSendMessqgeDialog}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmSendMessqgeDialog}},[e._v("确认")])],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.orderDialogVisible,title:"订单内容",width:"40%"},on:{"update:visible":function(t){e.orderDialogVisible=t}}},[o("el-form",[o("el-form-item",{attrs:{label:"营销活动编号"}},[o("el-input",{attrs:{placeholder:"营销活动编号"},model:{value:e.orderForm.activityId,callback:function(t){e.$set(e.orderForm,"activityId",t)},expression:"orderForm.activityId"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"营销活动名称"}},[o("el-input",{attrs:{placeholder:"营销活动名称"},model:{value:e.orderForm.activityName,callback:function(t){e.$set(e.orderForm,"activityName",t)},expression:"orderForm.activityName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"销售人员编号"}},[o("el-input",{attrs:{placeholder:"销售人员编号"},model:{value:e.orderForm.salespersonId,callback:function(t){e.$set(e.orderForm,"salespersonId",t)},expression:"orderForm.salespersonId"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"销售人员名称"}},[o("el-input",{attrs:{placeholder:"销售人员名称"},model:{value:e.orderForm.salespersonName,callback:function(t){e.$set(e.orderForm,"salespersonName",t)},expression:"orderForm.salespersonName"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeOrderDialog}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmOrderDialog}},[e._v("确认")])],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.orderDialogVisible2,title:"订单内容",width:"40%"},on:{"update:visible":function(t){e.orderDialogVisible2=t}}},[o("el-form",[o("el-form-item",{attrs:{label:"配件编号"}},[o("el-input",{attrs:{placeholder:"配件编号"},model:{value:e.orderForm.accessoryId,callback:function(t){e.$set(e.orderForm,"accessoryId",t)},expression:"orderForm.accessoryId"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配件名称"}},[o("el-input",{attrs:{placeholder:"配件名称"},model:{value:e.orderForm.accessoryName,callback:function(t){e.$set(e.orderForm,"accessoryName",t)},expression:"orderForm.accessoryName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配件型号"}},[o("el-input",{attrs:{placeholder:"配件型号"},model:{value:e.orderForm.accessoryType,callback:function(t){e.$set(e.orderForm,"accessoryType",t)},expression:"orderForm.accessoryType"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配件数量"}},[o("el-input",{attrs:{placeholder:"配件数量"},model:{value:e.orderForm.accessoryQuantity,callback:function(t){e.$set(e.orderForm,"accessoryQuantity",t)},expression:"orderForm.accessoryQuantity"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"配件单价"}},[o("el-input",{attrs:{placeholder:"配件单价"},model:{value:e.orderForm.accessoryAmount,callback:function(t){e.$set(e.orderForm,"accessoryAmount",t)},expression:"orderForm.accessoryAmount"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeOrderDialog2}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmOrderDialog2}},[e._v("确认")])],1)],1)],1)},staticRenderFns:[]},n=o("VU/8")(s,r,!1,null,null,null);t.default=n.exports}});